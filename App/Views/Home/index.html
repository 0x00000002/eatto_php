{% extends "base.html" %}
{% block title %}Eat together{% endblock %}
{% block menu %}

<header class="nav navbar-fixed-top main-page">
    <nav class="top-menu">
        <div>
            <a class="logo" href="/">eattogether</a>
        </div>
        {% if current_user %}
        <div><a href="/hosts">Find hosts</a></div>
        {% endif %}
        <div>
            {% if current_user %}
            <a href="/meetings"><img id="i-meeting" src="/assets/img/icons/mtg-w.png" alt="Meeting request"></a>
            <a href="/messages"><img id="i-message" src="/assets/img/icons/msg-w.png" alt="Messages"></a>
            <a href='/profile'><span id="i-profile">{{ current_user.email }}</span></a>
            <button onclick="location.href='/logout';"> Log out </i></button>
            {% else %}
            <a class="" href="/signup">Sign up</a> &nbsp;
            <button onclick="location.href='/login';">Login</button>
            {% endif %}
        </div>
    </nav>
</header>

{% endblock %}

{% block before_body %}
{% endblock %}


{% block body%}

<section id="top" class="bg bg-top">
    <div class="container-fluid">
        <span class="sub">Free food for travelers</span>
        <h1>eattogether</h1>
        <button id="o1">How it works</button>
        <button id="o2">Find where to eat</button>
    </div>
    <div></div>
    <div><input type="image" id="changeNavBar" src="/assets/img/icons/bigdown.png" alt=""></button></div>
</section>

<section id="how" class="container-fluid">
    <h2>How it works</h2>
    <ul>
        <div>
            <figure>
                <img src="/assets/img/icons/bag.png" alt="Host buys ingredients">
                <figcaption>
                    <h3>Host buys ingredients</h3>
                    <p>By guest's proposal</p>
                </figcaption>
            </figure>
            <figure>
                <img src="/assets/img/icons/pot.png" alt="Guest cooks">
                <figcaption>
                    <h3>Guest cooks</h3>
                    <p>Don't forget to add some stories</p>
                </figcaption>
            </figure>
            <figure>
                <img src="/assets/img/icons/plate.png" alt="eattogether">
                <figcaption>
                    <h3>Eat together</h3>
                    <p>Time to feast and have fun</p>
                </figcaption>
            </figure>
        </div>
        <div>
            <img src="/assets/img/iphone.jpg" alt="mobile app example">
        </div>
        <div>
            <figure>
                <img src="/assets/img/icons/zoom.png" alt="Find host">
                <figcaption>
                    <h3>Find host</h3>
                    <p>Search any city you like</p>
                </figcaption>
            </figure>
            <figure>
                <img src="/assets/img/icons/feedback.png" alt="Leave feedback">
                <figcaption>
                    <h3>Send meeting request</h3>
                    <p>Propose date and meal</p>
                </figcaption>
            </figure>
            <figure>
                <img src="/assets/img/icons/meal.png" alt="Cook and eat">
                <figcaption>
                    <h3>Cook and eat</h3>
                    <p>Show how good are you</p>
                </figcaption>
            </figure>
        </div>
    </ul>
</section>

<section id="feed">
    <h2>Feed a traveler</h2>
    <span class="sub">in return you'll get</span>
    <div class="container-fluid">
        <figure>
            <img src="/assets/img/icons/b_meal.png" alt="meal">
            <figcaption>
                <h3>Delicious food cooked just for you</h3>
                <p>Save on restaurants and make the world a little better</p>
            </figcaption>
        </figure>
        <figure>
            <img src="/assets/img/icons/b_globe.png" alt="Globe">
            <figcaption>
                <h3>Cool stories all around the world</h3>
                <p>Just another way to experience cultural diversity</p>
            </figcaption>
        </figure>
        <figure>
            <img src="/assets/img/icons/b_book.png" alt="recipe book">
            <figcaption>
                <h3>Recipes, guidance and personal tips</h3>
                <p>You will watch all nuances and can ask questions</p>
            </figcaption>
        </figure>
        <figure>
            <img src="/assets/img/icons/b_heart.png" alt="Friends">
            <figcaption>
                <h3>More frieds</h3>
                <p>A great chance to meet exciting people</p>
            </figcaption>
        </figure>
    </div>
</section>

<section id="why" class="container-fluid">
    <h2>Why join?</h2>
    <span class="sub">Try new tastes and share experience</span>
    <div>
        <figure>
            <img src="/assets/img/why/friends.jpg" alt="">
            <figcaption>
                <h3>Travelers</h3>
                <p>
                    Free food for travelers. Need any other reason?
                    <br>But don't be a jerk. Learn some cool recipes, be in good mood, cook and have fun!
                </p>
            </figcaption>
        </figure>
        <figure>
            <img src="/assets/img/why/couple.jpg" alt="">
            <figcaption>
                <h3>Hosts</h3>
                <p>80% of travelers are less than 25 years old, young people who exploring the world before to create.
                    Sharing food with travelers is a safe way to donate, it is contribution to our own future
                    and great opportunity to learn something new about the world and ourselves.
                </p>
            </figcaption>
        </figure>
        <figure>
            <img src="/assets/img/why/georgia.jpg" alt="">
            <figcaption>
                <h3>Community</h3>
                <p>
                    We run this project for free and will be happy with any help.
                    You can contribute with coding, designing, moderating and just spreading a word.
                </p>
            </figcaption>
        </figure>
    </div>
    <p class="sub">... and it's free!</p>
    <a href="/signup" class="btn-big">Join us</a>
</section>

<section id="about" class="bg bg-community">
    <div>
        <h2>Our mission</h2>
        <p>
            <span>
                is to gather people from different countries around the table.
                A meal as an excuse and a great opportunity to spend time with fun and pleasure,
                experiencing new tastes and culture, sharing stories, moods and well-being with friends from all around
                the world.
            </span>
        </p>
    </div>
</section>

<section id="findhost">
    <h2>Find host</h2>
    <span class="sub">Host pays. Guest cooks. Eatto!</span>
    <form method="post" action="/hosts" name="findHost" onsubmit="return changeAction();">
        <input type="text"
               id="place_name"
               name="name"
               class="form-control"
               placeholder="Enter city name"
        />
        <input type="hidden" id="place_id" name="id" value="">
        <button type="submit" onclick="changeAction();" class="btn-norm" value=" Find ">Find</button>
    </form>
    <div id="map"></div>
</section>

<section id="reviews">
    <article>
        <h3>Be happy</h3>
        <p>The best way to be happy is to make happy someone else.</p>
    </article>
    <h2>We help each other</h2>
    <div class="container-fluid">
        <figure>
            <img src="/uploads/users/antipova.jpg" alt="Sarah Lewin">
            <figcation>
                <h3>Sarah Lewin</h3>
                <div class="sub">HR manager</div>
                <p>
                    Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta, nobis, tenetur!
                    Accusantium ad asperiores deserunt doloremque esse fuga ipsa ipsam maxime nulla placeat porro sit
                    suscipit, tempora temporibus velit voluptatum.
                </p>
            </figcation>
        </figure>
        <figure>
            <img src="/uploads/users/108/thumbs/Yo814FWI.jpg" alt="Aleksandr Tikhonov">
            <figcation>
                <h3>Aleksandr Tikhonov</h3>
                <div class="sub">Russian traveler</div>
                <p>I spent few years in Thailand and I really happy to have this site in my favs cause I know some
                    great recipes. And sometimes it is really nice to have place to eat and relax a little.</p>
            </figcation>
        </figure>
        <figure>
            <img src="/assets/img/daniel.jpg" alt="Daniel Kovács">
            <figcation>
                <h3>Daniel Kovács</h3>
                <div class="sub">Working Holiday Kanada</div>
                <p>
                    Mit Working Holiday Kanada wollen wir dir helfen, dein Work & Travel Abenteuer in Kanada selbst zu
                    planen und deine Reise zur besten Zeit deines Lebens zu machen.
                </p>
            </figcation>
        </figure>
    </div>
</section>

<section id="gallery">
    <div class="grid">
        <p></p>
        <p></p>
        <p></p>
        <p></p>
    </div>
    <a href="/signup" class="btn-big">Sign up</a>
</section>


{% endblock %}


{% block after_body %}
{% endblock %}


{% block scripts %}
<script>
    $(document).ready(function () {
        var scroll_start = 0;
        var startchange = $('#changeNavBar');
        var offset = startchange.offset();
        $(document).scroll(function () {
            scroll_start = $(this).scrollTop();
            if (scroll_start > offset.top) {
                $('.main-page').addClass("scrolled");
                $('.scrolled').removeClass("main-page");
                // $('#i-meeting').attr('src', '/assets/img/icons/mtg-w.png');
                // $('#i-message').attr('src', '/assets/img/icons/msg-w.png');
            } else {
                $('.scrolled').addClass("main-page");
                $('.main-page').removeClass("scrolled");
                // $('#i-meeting').attr('src', '/assets/img/icons/mtg-w.png');
                // $('#i-message').attr('src', '/assets/img/icons/msg-w.png');
            }
        });
    });

    $("#changeNavBar").click(function () {
        $('html,body').animate({
                scrollTop: $("#how").offset().top
            },
            'slow');
    });


    $("#o1").click(function () {
        $('html,body').animate({
                scrollTop: $("#how").offset().top
            },
            'slow');
    });

    $("#l1").click(function () {
        window.location = '/meetings';
    });


    $("#o2").click(function () {
        $('html,body').animate({
                scrollTop: $("#findhost").offset().top
            },
            'slow');
    });

    function initMap() {

        var map = new google.maps.Map(document.getElementById('map'), {
            center: {{location}},
            zoom: 11
        });

        infoWindow = new google.maps.InfoWindow;

        // Try HTML5 geolocation.
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function (position) {
                var pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

//                infoWindow.setPosition(pos);
//                infoWindow.setContent('Location found.');
                infoWindow.open(map);
                map.setCenter(pos);
            }, function () {
                handleLocationError(true, infoWindow, map.getCenter());
            });
        } else {
            // Browser doesn't support Geolocation
            handleLocationError(false, infoWindow, map.getCenter());
        }


        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
            infoWindow.setPosition(pos);
            infoWindow.setContent(browserHasGeolocation ?
                'Error: The Geolocation service failed.' :
                'Error: Your browser doesn\'t support geolocation.');
            infoWindow.open(map);
        }

        var marker = new google.maps.Marker({
            map: map
        });
    }

    function initialize() {
        var options = {
            types: ['(cities)'],
        };

        var input = document.getElementById('place_name');
        var autocomplete = new google.maps.places.Autocomplete(input, options);

        google.maps.event.addListener(autocomplete, 'place_changed', function () {
            var place = autocomplete.getPlace();
            if (place != undefined) {
                document.getElementById('place_id').value = place.id;
            }
        });

        initMap();
    }

    $(document).ready(function () {
        $(window).keydown(function (event) {
            if (event.keyCode == 13) {
                event.preventDefault();
                return false;
            }
        });
    });


    $(document).ready(
        function pullNotifications() {
            $.ajax({
                url: "/notifications",
                success: function (json) {
                    //console.log(json);
                    if (json.mtg == 0)
                        document.getElementById("i-meeting").src = "/assets/img/icons/mtg-w.png";
                    if (json.mtg == 1)
                        document.getElementById("i-meeting").src = "/assets/img/icons/mtg-g.png";
                    if (json.msg == 0)
                        document.getElementById("i-message").src = "/assets/img/icons/msg-w.png";
                    if (json.msg == 1)
                        document.getElementById("i-message").src = "/assets/img/icons/msg-g.png";
                    if (json.ref == 0)
                        $("#i-profile").removeClass("");
                    if (json.ref == 1)
                        $("#i-profile").addClass("");

                    setTimeout(function () {
                        pullNotifications();
                    }, 3000);
                }
                ,
                error: function () {
                    console.log('Can not run ajax');
                }
            })
        })

</script>

<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDrewHwdEUOk9rtiKTPzZOCYNnEPcQX-is&libraries=places&callback=initialize">
</script>

{% endblock %}
